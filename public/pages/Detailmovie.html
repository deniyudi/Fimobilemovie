<style>
    .demo-card-header-pic .card-header {
  height: 100vw;
  background-size: contain;
  background-position: center;
  color: #fff;
}
.demo-card-header-pic .card-content-padding .date{
  color: #8e8e93;
}
</style>

<template>
    <div class="page light">
        <div class="navbar">
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="material-icons">navigate_before</i>
                    </a>
                </div>
                <div class="title"><img src="img/logo-header.png" alt="" class="header-logo"> </div>
                <div class="right">
                    <a class="link icon-only searchbar-enable" data-searchbar=".searchbar-com-de">
                        <i class="icon material-icons">search</i>
                    </a>
                </div>
    
                <form data-search-container=".components-list" data-search-in="a" class="searchbar searchbar-expandable searchbar-com-de searchbar-init">
                    <div class="searchbar-inner">
                        <div class="searchbar-input-wrap">
                            <input type="search" placeholder="Search components">
                            <i class="searchbar-icon"></i>
                            <span class="input-clear-button"></span>
                        </div>
                        <span class="searchbar-disable-button if-not-aurora"></span>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="page-content">
            <div class="block">
                <div class="card demo-card-header-pic">
                    <img src="https://image.tmdb.org/t/p/w1280{{movie.poster_path}}" width="100%" style="border-radius:2%;"/>
                    <!-- <div class="card-content card-content-padding">
                      <div class="subtitle">
                      </div>
                    </div> -->
                    <div class="card-footer">
                        <span>
                            <div class="text-align-right">
                                <div class="row">
                                    <div class="avatar avatar-50 no-shadow border-0">    
                                        <i class="material-icons text-template ">star_lefthalf_fill</i>
                                    </div>
                                    <div class="col align-self-center pl-0">{{movie.vote_average}}</div>
                                </div>
                            </div>
                        </span>
                        <span>
                            <div class="text-align-right">
                                <div class="row">
                                    <div class="avatar avatar-50 no-shadow border-0">    
                                        <i class="material-icons text-template ">visibility</i>
                                    </div>
                                <div class="col align-self-center pl-0">{{movie.popularity}}</div> 
                                </div>
                            </div>
                        </span>
                        <span>
                            <div class="text-align-right">
                                <div class="row">
                                    <div class="avatar avatar-50 no-shadow border-0">    
                                        <i class="material-icons text-template ">watch_later
                                        </i>
                                    </div>
                                <div class="col align-self-center pl-0">{{movie.runtime}} min</div>
                                </div>
                            </div>
                        </span>
                    </div>
                    <div class="card-footer h-120">
                        <div class="col">
                            <h3 style="font-weight: bold; color: black;">{{movie.original_title}}</h3>
                            <p>{{movie.overview}}</p>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="col">
                            <tr>
                                <td><b>Release</b></td>
                                <td>:</td>
                                <td>{{movie.release_date}}</td>
                            </tr>
                        </div>
                    </div>
                    <div class="card-footer">
                        <span>
                            <div class="col">
                                <tr>
                                    <td><b>{{movie.directors[0].job}}</b></td>
                                    <td>:</td>
                                    <td>{{movie.directors[0].name}}</td>
                                </tr>
                            </div>
                        </span>
                        <!-- <span>
                            <div class="col">
                                <b>
                                    <p>Greg Nowkolow</p>
                                </b>
                                <p>Kreator</p>
                            </div>
                        </span>
                        <span>
                            <div class="col">
                                <b>
                                    <p>Berlanti</p>
                                </b>
                                <p>Kreator</p>
                            </div>
                        </span> -->
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>Actors:</h3></div>
                    <div class="card-content">
                      <div class="list media-list">
                        <ul>
                          <li class="item-content">
                            <div class="item-media"><img src="https://image.tmdb.org/t/p/w120_and_h133_face{{movie.actors[0].profile_path}}" width="80" style="border-radius: 10%;"/></div>
                            <div class="item-inner">
                              <div class="item-title-row">
                                <div class="item-title">{{movie.actors[0].name}}</div>
                              </div>
                              <div class="item-subtitle">{{movie.actors[0].character}}</div>
                            </div>
                          </li>
                          <li class="item-content">
                            <div class="item-media"><img src="https://image.tmdb.org/t/p/w120_and_h133_face{{movie.actors[1].profile_path}}" width="80" style="border-radius: 10%;"/></div>
                            <div class="item-inner">
                              <div class="item-title-row">
                                <div class="item-title">{{movie.actors[1].name}}</div>
                              </div>
                              <div class="item-subtitle">{{movie.actors[1].character}}</div>
                            </div>
                          </li>
                          <li class="item-content">
                            <div class="item-media"><img src="https://image.tmdb.org/t/p/w120_and_h133_face{{movie.actors[2].profile_path}}" width="80" style="border-radius: 10%;"/></div>
                            <div class="item-inner">
                              <div class="item-title-row">
                                <div class="item-title">{{movie.actors[2].name}}</div>
                              </div>
                              <div class="item-subtitle">{{movie.actors[2].character}}</div>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div class="card-footer"></div>
                  </div>
            </div>
        </div>
    </div>
    
</template>

<script>
    const API_URL = 'https://api.themoviedb.org/3/';
    const API_KEY = '7e97f4650ad722d5b44df91dee514674';
    const MOVIE_ENDPOINT = id => `https://api.themoviedb.org/3/movie/${id}?api_key=7e97f4650ad722d5b44df91dee514674`;
    const CREDITS_ENDPOINT = id => `${API_URL}movie/${id}/credits?api_key=${API_KEY}`;

    return {
        
        data: async function(){

            var movie;
            
                try{
                    idmov = window.localStorage.getItem('id');
                    movie = await fetchMovie(idmov);
                    console.log(movie);
                }catch(err){
                    error = true;
                }

             async function fetchMovie (movieId) {
                const endpoint = `https://api.themoviedb.org/3/movie/${movieId}?api_key=7e97f4650ad722d5b44df91dee514674`;
                const creditsEndpoint = CREDITS_ENDPOINT(movieId);

                const result = await (await fetch(endpoint)).json();
                const creditsResult = await (await fetch(creditsEndpoint)).json();

                const directors = creditsResult.crew.filter(
                    member => member.job === 'Director'
                );

                return {
                    ...result,
                    actors: creditsResult.cast,
                    directors
                }
        
            }
            return{
                movie
            }
    }
    }
</script>